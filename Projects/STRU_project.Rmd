---
title: "Modelling of interventions during Ebola outbreaks"
---

```{r setup, echo=FALSE, cache=FALSE}
knitr::opts_chunk$set(cache = TRUE, fig.path = "figure/STRU_project/", cache.path = "../cache/STRU_project/", fig.cap = "", fig.align = "center", message = FALSE, tidy = TRUE, warning = FALSE)
```

```{r fitR, cache=FALSE, echo=FALSE}
library(fitR)
set.seed(1234)
```

# Introduction

Ebola outbreaks have been observed in Africa since 1976. Each time, the outbreak has been controled thanks to interventions aimed at reducing the reproduction number ($R$): the average number of secondary cases generated by one infectious individual. 

The goal of this project is to analyse the time-series of an outbreak in order to uncover which intervention was implemented at the time and how effective it was. For simplicity, we assume that interventions can have only two effects on $R$:

* __Linear decay__ following the start of the intervention, $R$ decreases linearly over time until it reaches zero.
* __Step decay__ following the start of the intervention, $R$ is reduced by a given proportion.

We note $R_0$ the initial reproduction number, $t_{intervention}$ the start time of the intervention and $\alpha$ either the slope of the linear decay or the proportion of reduction of the step decay.

Finally, we assume that weekly incidence were observed through a Poisson process. However, the data were either generated by a random sample or the expected observation.

# Objectives

* Design two SEIR models implementing the interventions described above.
* Fit both models using MCMC to one of the datasets you have been assigned.
* Estimate the change in the reproduction number ($R_t$) over time for each model.
* Compare both models using model selection techniques.
* Discuss your findings and limitations of your approach. 

# Datasets

Download the dataset you have been assigned:

* [Dataset 1](data/ebola_dataset_1.csv): Willem & Chéima
* [Dataset 2](data/ebola_dataset_2.csv): Hugo & Rémi
* [Dataset 3](data/ebola_dataset_3.csv): Alexis & Tim
* [Dataset 4](data/ebola_dataset_4.csv): Ségolène, Marc & Matthieu

Each dataset contains the __weekly__ observed incidence of new cases for a period of 64 weeks and is a unique combination of one intervention (linear or step) and one observation (random or expected).

```{r datasets, fig.width=10, echo=FALSE, cache=FALSE}
# library(R2C3)
library(readr)
library(plyr)
library(dplyr)

dirDataset <- path.expand("~/edu/Fit_course/mfiidd/website/data")

dfData <- ldply(1:4, function(i) {
  read_csv(file.path(dirDataset, sprintf("ebola_dataset_%s.csv", i))) %>% mutate(dataset = sprintf("Dataset %s", i))
})

dfData %>%
  chart(x = "time", y = "obs", type = "line", group_by = c("dataset"), time_series = FALSE) %>%
  set_legend(position = "right") %>%
  add_zoom() #  %>%
# R2C3
```

# Model

Each member of the group should implement one deterministic SEIR model. You can modify one of the model provided during the practicals (SIR or SEITL) to include a time varying reproduction number. You will also need to choose an observation model, priors for the parameters as well as initial conditions for your model.

# Initial conditions & parameters

* The population is fixed to 100,000 individuals. 
* Intially, 5 individuals are infectious and the rest of the population is susceptible.
* The average latent period has been estimated at 9 days with a standard deviation of 2 days. 
* The latent period follows an Erlang distribution with shape equal to 2.
* The average infectious period has been estimated at 10 days with a standard deviation of 2 days.
* The average infectious period follows an Exponential distribution.


# Report

Your report should be formatted like an article:

* __Abstract__ a 10-line summary of the question, methods, results and main conclusion of your work.
* __Introduction__ briefly explain the question you want to address and the approach you are going to use, avoiding technical terms.
* __Methods__ explain every step of your approach in a technical way (e.g. differential equations, parametrisation of your MCMC, etc).
* __Results__ show your results with necessary evidence (figures & tables). If necessary, additional but not essential results can be added in a technical appendix.
* __Discussion__ summarize your findings, conclude regarding your initial question and discuss the limitations of your approach.
* __Appendix__ reproduce your `R` code for the `fitmodel` objects you created. The code should be commented for the sake of readibility.


# Bonus

Implement your _best_ model using a stochastic framework and compare the stochastic simulations (using the distribution a posteriori of the parameters) with the data.


